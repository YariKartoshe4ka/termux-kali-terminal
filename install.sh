#!/data/data/com.termux/files/usr/bin/bash

TERMUX_ROOT="/data/data/com.termux/files"
OUTPUT_PIPE="/dev/null" # You can change it to /dev/stdout to enable output
ZSHRC_BASE64_ENCODED="IyBUZXJtdXggc3BlY2lmaWMgdmFyaWFibGVzClRFUk1VWF9ST09UPSIvZGF0YS9kYXRhL2NvbS50ZXJtdXgvZmlsZXMiCgojIH4vLnpzaHJjIGZpbGUgZm9yIHpzaCBpbnRlcmFjdGl2ZSBzaGVsbHMuCiMgc2VlIC91c3Ivc2hhcmUvZG9jL3pzaC9leGFtcGxlcy96c2hyYyBmb3IgZXhhbXBsZXMKCnNldG9wdCBhdXRvY2QgICAgICAgICAgICAgICMgY2hhbmdlIGRpcmVjdG9yeSBqdXN0IGJ5IHR5cGluZyBpdHMgbmFtZQojc2V0b3B0IGNvcnJlY3QgICAgICAgICAgICAjIGF1dG8gY29ycmVjdCBtaXN0YWtlcwpzZXRvcHQgaW50ZXJhY3RpdmVjb21tZW50cyAjIGFsbG93IGNvbW1lbnRzIGluIGludGVyYWN0aXZlIG1vZGUKc2V0b3B0IG1hZ2ljZXF1YWxzdWJzdCAgICAgIyBlbmFibGUgZmlsZW5hbWUgZXhwYW5zaW9uIGZvciBhcmd1bWVudHMgb2YgdGhlIGZvcm0g4oCYYW55dGhpbmc9ZXhwcmVzc2lvbuKAmQpzZXRvcHQgbm9ub21hdGNoICAgICAgICAgICAjIGhpZGUgZXJyb3IgbWVzc2FnZSBpZiB0aGVyZSBpcyBubyBtYXRjaCBmb3IgdGhlIHBhdHRlcm4Kc2V0b3B0IG5vdGlmeSAgICAgICAgICAgICAgIyByZXBvcnQgdGhlIHN0YXR1cyBvZiBiYWNrZ3JvdW5kIGpvYnMgaW1tZWRpYXRlbHkKc2V0b3B0IG51bWVyaWNnbG9ic29ydCAgICAgIyBzb3J0IGZpbGVuYW1lcyBudW1lcmljYWxseSB3aGVuIGl0IG1ha2VzIHNlbnNlCnNldG9wdCBwcm9tcHRzdWJzdCAgICAgICAgICMgZW5hYmxlIGNvbW1hbmQgc3Vic3RpdHV0aW9uIGluIHByb21wdAoKV09SRENIQVJTPSR7V09SRENIQVJTLy9cL30gIyBEb24ndCBjb25zaWRlciBjZXJ0YWluIGNoYXJhY3RlcnMgcGFydCBvZiB0aGUgd29yZAoKIyBoaWRlIEVPTCBzaWduICgnJScpClBST01QVF9FT0xfTUFSSz0iIgoKIyBjb25maWd1cmUga2V5IGtleWJpbmRpbmdzCmJpbmRrZXkgLWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBlbWFjcyBrZXkgYmluZGluZ3MKYmluZGtleSAnICcgbWFnaWMtc3BhY2UgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGRvIGhpc3RvcnkgZXhwYW5zaW9uIG9uIHNwYWNlCmJpbmRrZXkgJ15bWzM7NX4nIGtpbGwtd29yZCAgICAgICAgICAgICAgICAgICAgICAgIyBjdHJsICsgU3VwcgpiaW5ka2V5ICdeW1szficgZGVsZXRlLWNoYXIgICAgICAgICAgICAgICAgICAgICAgICMgZGVsZXRlCmJpbmRrZXkgJ15bWzE7NUMnIGZvcndhcmQtd29yZCAgICAgICAgICAgICAgICAgICAgIyBjdHJsICsgLT4KYmluZGtleSAnXltbMTs1RCcgYmFja3dhcmQtd29yZCAgICAgICAgICAgICAgICAgICAjIGN0cmwgKyA8LQpiaW5ka2V5ICdeW1s1ficgYmVnaW5uaW5nLW9mLWJ1ZmZlci1vci1oaXN0b3J5ICAgICMgcGFnZSB1cApiaW5ka2V5ICdeW1s2ficgZW5kLW9mLWJ1ZmZlci1vci1oaXN0b3J5ICAgICAgICAgICMgcGFnZSBkb3duCmJpbmRrZXkgJ15bW0gnIGJlZ2lubmluZy1vZi1saW5lICAgICAgICAgICAgICAgICAgIyBob21lCmJpbmRrZXkgJ15bW0YnIGVuZC1vZi1saW5lICAgICAgICAgICAgICAgICAgICAgICAgIyBlbmQKYmluZGtleSAnXltbWicgdW5kbyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHNoaWZ0ICsgdGFiIHVuZG8gbGFzdCBhY3Rpb24KCiMgZW5hYmxlIGNvbXBsZXRpb24gZmVhdHVyZXMKYXV0b2xvYWQgLVV6IGNvbXBpbml0CmNvbXBpbml0IC1kIH4vLmNhY2hlL3pjb21wZHVtcAp6c3R5bGUgJzpjb21wbGV0aW9uOio6KjoqOio6KicgbWVudSBzZWxlY3QKenN0eWxlICc6Y29tcGxldGlvbjoqJyBhdXRvLWRlc2NyaXB0aW9uICdzcGVjaWZ5OiAlZCcKenN0eWxlICc6Y29tcGxldGlvbjoqJyBjb21wbGV0ZXIgX2V4cGFuZCBfY29tcGxldGUgX2NvcnJlY3QgX2FwcHJveGltYXRlCnpzdHlsZSAnOmNvbXBsZXRpb246KicgZm9ybWF0ICdDb21wbGV0aW5nICVkJwp6c3R5bGUgJzpjb21wbGV0aW9uOionIGdyb3VwLW5hbWUgJycKenN0eWxlICc6Y29tcGxldGlvbjoqJyBsaXN0LWNvbG9ycyAnJwp6c3R5bGUgJzpjb21wbGV0aW9uOionIGxpc3QtcHJvbXB0ICVTQXQgJXA6IEhpdCBUQUIgZm9yIG1vcmUsIG9yIHRoZSBjaGFyYWN0ZXIgdG8gaW5zZXJ0JXMKenN0eWxlICc6Y29tcGxldGlvbjoqJyBtYXRjaGVyLWxpc3QgJ206e2EtekEtWn09e0EtWmEten0nCnpzdHlsZSAnOmNvbXBsZXRpb246KicgcmVoYXNoIHRydWUKenN0eWxlICc6Y29tcGxldGlvbjoqJyBzZWxlY3QtcHJvbXB0ICVTU2Nyb2xsaW5nIGFjdGl2ZTogY3VycmVudCBzZWxlY3Rpb24gYXQgJXAlcwp6c3R5bGUgJzpjb21wbGV0aW9uOionIHVzZS1jb21wY3RsIGZhbHNlCnpzdHlsZSAnOmNvbXBsZXRpb246KicgdmVyYm9zZSB0cnVlCnpzdHlsZSAnOmNvbXBsZXRpb246KjpraWxsOionIGNvbW1hbmQgJ3BzIC11ICRVU0VSIC1vIHBpZCwlY3B1LHR0eSxjcHV0aW1lLGNtZCcKCiMgSGlzdG9yeSBjb25maWd1cmF0aW9ucwpISVNURklMRT1+Ly56c2hfaGlzdG9yeQpISVNUU0laRT0xMDAwClNBVkVISVNUPTIwMDAKc2V0b3B0IGhpc3RfZXhwaXJlX2R1cHNfZmlyc3QgIyBkZWxldGUgZHVwbGljYXRlcyBmaXJzdCB3aGVuIEhJU1RGSUxFIHNpemUgZXhjZWVkcyBISVNUU0laRQpzZXRvcHQgaGlzdF9pZ25vcmVfZHVwcyAgICAgICAjIGlnbm9yZSBkdXBsaWNhdGVkIGNvbW1hbmRzIGhpc3RvcnkgbGlzdApzZXRvcHQgaGlzdF9pZ25vcmVfc3BhY2UgICAgICAjIGlnbm9yZSBjb21tYW5kcyB0aGF0IHN0YXJ0IHdpdGggc3BhY2UKc2V0b3B0IGhpc3RfdmVyaWZ5ICAgICAgICAgICAgIyBzaG93IGNvbW1hbmQgd2l0aCBoaXN0b3J5IGV4cGFuc2lvbiB0byB1c2VyIGJlZm9yZSBydW5uaW5nIGl0CiNzZXRvcHQgc2hhcmVfaGlzdG9yeSAgICAgICAgICMgc2hhcmUgY29tbWFuZCBoaXN0b3J5IGRhdGEKCiMgZm9yY2UgenNoIHRvIHNob3cgdGhlIGNvbXBsZXRlIGhpc3RvcnkKYWxpYXMgaGlzdG9yeT0iaGlzdG9yeSAwIgoKIyBjb25maWd1cmUgYHRpbWVgIGZvcm1hdApUSU1FRk1UPSQnXG5yZWFsXHQlRVxudXNlclx0JVVcbnN5c1x0JVNcbmNwdVx0JVAnCgojIG1ha2UgbGVzcyBtb3JlIGZyaWVuZGx5IGZvciBub24tdGV4dCBpbnB1dCBmaWxlcywgc2VlIGxlc3NwaXBlKDEpCiNbIC14IC91c3IvYmluL2xlc3NwaXBlIF0gJiYgZXZhbCAiJChTSEVMTD0vYmluL3NoIGxlc3NwaXBlKSIKCiMgc2V0IHZhcmlhYmxlIGlkZW50aWZ5aW5nIHRoZSBjaHJvb3QgeW91IHdvcmsgaW4gKHVzZWQgaW4gdGhlIHByb21wdCBiZWxvdykKaWYgWyAteiAiJHtkZWJpYW5fY2hyb290Oi19IiBdICYmIFsgLXIgL2V0Yy9kZWJpYW5fY2hyb290IF07IHRoZW4KICAgIGRlYmlhbl9jaHJvb3Q9JChjYXQgL2V0Yy9kZWJpYW5fY2hyb290KQpmaQoKY29uZmlndXJlX3Byb21wdCgpIHsKICAgIHByb21wdF9zeW1ib2w944m/CiAgICBbICIkRVVJRCIgLWVxIDAgXSAmJiBwcm9tcHRfc3ltYm9sPfCfkoAKICAgIGNhc2UgIiRQUk9NUFRfQUxURVJOQVRJVkUiIGluCiAgICAgICAgdHdvbGluZSkKICAgICAgICAgICAgUFJPTVBUPSQnJUZ7JSgjLmJsdWUuY3lhbil94pSM4pSA4pSAJHtkZWJpYW5fY2hyb290OisoJGRlYmlhbl9jaHJvb3Qp4pSAfSR7VklSVFVBTF9FTlY6KygkKGJhc2VuYW1lICRWSVJUVUFMX0VOVikp4pSAfSglQiVGeyUoIy5yZWQuYmx1ZSl9JW4kcHJvbXB0X3N5bWJvbCVtJWIlRnslKCMuYmx1ZS5jeWFuKX0pLVslQiVGe3Jlc2V0fSUoNn4uJS0xfi/igKYvJTR+LiU1fiklYiVGeyUoIy5ibHVlLmN5YW4pfV1cbuKUlOKUgCVCJSgjLiVGe3JlZH0jLiVGe2JsdWV9JCklYiVGe3Jlc2V0fSAnCiAgICAgICAgICAgIFJQUk9NUFQ9JCclKD8uLiAlPyAlRntyZWR9JULiqK8lYiVGe3Jlc2V0fSklKDFqLiAlaiAlRnt5ZWxsb3d9JULimpklYiVGe3Jlc2V0fS4pJwogICAgICAgICAgICA7OwogICAgICAgIG9uZWxpbmUpCiAgICAgICAgICAgIFBST01QVD0kJyR7ZGViaWFuX2Nocm9vdDorKCRkZWJpYW5fY2hyb290KX0ke1ZJUlRVQUxfRU5WOisoJChiYXNlbmFtZSAkVklSVFVBTF9FTlYpKX0lQiVGeyUoIy5yZWQuYmx1ZSl9JW5AJW0lYiVGe3Jlc2V0fTolQiVGeyUoIy5ibHVlLmN5YW4pfSV+JWIlRntyZXNldH0lKCMuIy4kKSAnCiAgICAgICAgICAgIFJQUk9NUFQ9CiAgICAgICAgICAgIDs7CiAgICAgICAgYmFja3RyYWNrKQogICAgICAgICAgICBQUk9NUFQ9JCcke2RlYmlhbl9jaHJvb3Q6KygkZGViaWFuX2Nocm9vdCl9JHtWSVJUVUFMX0VOVjorKCQoYmFzZW5hbWUgJFZJUlRVQUxfRU5WKSl9JUIlRntyZWR9JW5AJW0lYiVGe3Jlc2V0fTolQiVGe2JsdWV9JX4lYiVGe3Jlc2V0fSUoIy4jLiQpICcKICAgICAgICAgICAgUlBST01QVD0KICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKIyBUaGUgZm9sbG93aW5nIGJsb2NrIGlzIHN1cnJvdW5kZWQgYnkgdHdvIGRlbGltaXRlcnMuCiMgVGhlc2UgZGVsaW1pdGVycyBtdXN0IG5vdCBiZSBtb2RpZmllZC4gVGhhbmtzLgojIFNUQVJUIEtBTEkgQ09ORklHIFZBUklBQkxFUwpQUk9NUFRfQUxURVJOQVRJVkU9dHdvbGluZQpORVdMSU5FX0JFRk9SRV9QUk9NUFQ9eWVzCiMgU1RPUCBLQUxJIENPTkZJRyBWQVJJQUJMRVMKCmNvbG9yX3Byb21wdD15ZXMKaWYgWyAiJGNvbG9yX3Byb21wdCIgPSB5ZXMgXTsgdGhlbgogICAgIyBvdmVycmlkZSBkZWZhdWx0IHZpcnR1YWxlbnYgaW5kaWNhdG9yIGluIHByb21wdAogICAgVklSVFVBTF9FTlZfRElTQUJMRV9QUk9NUFQ9MQoKICAgIGNvbmZpZ3VyZV9wcm9tcHQKCiAgICAjIGVuYWJsZSBzeW50YXgtaGlnaGxpZ2h0aW5nCiAgICBpZiBbIC1mICRURVJNVVhfUk9PVC91c3Ivc2hhcmUvenNoLXN5bnRheC1oaWdobGlnaHRpbmcvenNoLXN5bnRheC1oaWdobGlnaHRpbmcuenNoIF0gJiYgWyAiJGNvbG9yX3Byb21wdCIgPSB5ZXMgXTsgdGhlbgogICAgICAgIC4gJFRFUk1VWF9ST09UL3Vzci9zaGFyZS96c2gtc3ludGF4LWhpZ2hsaWdodGluZy96c2gtc3ludGF4LWhpZ2hsaWdodGluZy56c2gKICAgICAgICBaU0hfSElHSExJR0hUX0hJR0hMSUdIVEVSUz0obWFpbiBicmFja2V0cyBwYXR0ZXJuKQogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2RlZmF1bHRdPW5vbmUKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1t1bmtub3duLXRva2VuXT1mZz1yZWQsYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW3Jlc2VydmVkLXdvcmRdPWZnPWN5YW4sYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW3N1ZmZpeC1hbGlhc109Zmc9Z3JlZW4sdW5kZXJsaW5lCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbZ2xvYmFsLWFsaWFzXT1mZz1tYWdlbnRhCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbcHJlY29tbWFuZF09Zmc9Z3JlZW4sdW5kZXJsaW5lCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbY29tbWFuZHNlcGFyYXRvcl09Zmc9Ymx1ZSxib2xkCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbYXV0b2RpcmVjdG9yeV09Zmc9Z3JlZW4sdW5kZXJsaW5lCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbcGF0aF09dW5kZXJsaW5lCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbcGF0aF9wYXRoc2VwYXJhdG9yXT0KICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1twYXRoX3ByZWZpeF9wYXRoc2VwYXJhdG9yXT0KICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1tnbG9iYmluZ109Zmc9Ymx1ZSxib2xkCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbaGlzdG9yeS1leHBhbnNpb25dPWZnPWJsdWUsYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2NvbW1hbmQtc3Vic3RpdHV0aW9uXT1ub25lCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbY29tbWFuZC1zdWJzdGl0dXRpb24tZGVsaW1pdGVyXT1mZz1tYWdlbnRhCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbcHJvY2Vzcy1zdWJzdGl0dXRpb25dPW5vbmUKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1twcm9jZXNzLXN1YnN0aXR1dGlvbi1kZWxpbWl0ZXJdPWZnPW1hZ2VudGEKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1tzaW5nbGUtaHlwaGVuLW9wdGlvbl09Zmc9bWFnZW50YQogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2RvdWJsZS1oeXBoZW4tb3B0aW9uXT1mZz1tYWdlbnRhCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbYmFjay1xdW90ZWQtYXJndW1lbnRdPW5vbmUKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1tiYWNrLXF1b3RlZC1hcmd1bWVudC1kZWxpbWl0ZXJdPWZnPWJsdWUsYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW3NpbmdsZS1xdW90ZWQtYXJndW1lbnRdPWZnPXllbGxvdwogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2RvdWJsZS1xdW90ZWQtYXJndW1lbnRdPWZnPXllbGxvdwogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2RvbGxhci1xdW90ZWQtYXJndW1lbnRdPWZnPXllbGxvdwogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW3JjLXF1b3RlXT1mZz1tYWdlbnRhCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbZG9sbGFyLWRvdWJsZS1xdW90ZWQtYXJndW1lbnRdPWZnPW1hZ2VudGEKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1tiYWNrLWRvdWJsZS1xdW90ZWQtYXJndW1lbnRdPWZnPW1hZ2VudGEKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1tiYWNrLWRvbGxhci1xdW90ZWQtYXJndW1lbnRdPWZnPW1hZ2VudGEKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1thc3NpZ25dPW5vbmUKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1tyZWRpcmVjdGlvbl09Zmc9Ymx1ZSxib2xkCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbY29tbWVudF09Zmc9YmxhY2ssYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW25hbWVkLWZkXT1ub25lCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbbnVtZXJpYy1mZF09bm9uZQogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2FyZzBdPWZnPWdyZWVuCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbYnJhY2tldC1lcnJvcl09Zmc9cmVkLGJvbGQKICAgICAgICBaU0hfSElHSExJR0hUX1NUWUxFU1ticmFja2V0LWxldmVsLTFdPWZnPWJsdWUsYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2JyYWNrZXQtbGV2ZWwtMl09Zmc9Z3JlZW4sYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2JyYWNrZXQtbGV2ZWwtM109Zmc9bWFnZW50YSxib2xkCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbYnJhY2tldC1sZXZlbC00XT1mZz15ZWxsb3csYm9sZAogICAgICAgIFpTSF9ISUdITElHSFRfU1RZTEVTW2JyYWNrZXQtbGV2ZWwtNV09Zmc9Y3lhbixib2xkCiAgICAgICAgWlNIX0hJR0hMSUdIVF9TVFlMRVNbY3Vyc29yLW1hdGNoaW5nYnJhY2tldF09c3RhbmRvdXQKICAgIGZpCmVsc2UKICAgIFBST01QVD0nJHtkZWJpYW5fY2hyb290OisoJGRlYmlhbl9jaHJvb3QpfSVuQCVtOiV+JSMgJwpmaQp1bnNldCBjb2xvcl9wcm9tcHQKCnRvZ2dsZV9vbmVsaW5lX3Byb21wdCgpewogICAgaWYgWyAiJFBST01QVF9BTFRFUk5BVElWRSIgPSBvbmVsaW5lIF07IHRoZW4KICAgICAgICBQUk9NUFRfQUxURVJOQVRJVkU9dHdvbGluZQogICAgZWxzZQogICAgICAgIFBST01QVF9BTFRFUk5BVElWRT1vbmVsaW5lCiAgICBmaQogICAgY29uZmlndXJlX3Byb21wdAogICAgemxlIHJlc2V0LXByb21wdAp9CnpsZSAtTiB0b2dnbGVfb25lbGluZV9wcm9tcHQKYmluZGtleSBeUCB0b2dnbGVfb25lbGluZV9wcm9tcHQKCiMgSWYgdGhpcyBpcyBhbiB4dGVybSBzZXQgdGhlIHRpdGxlIHRvIHVzZXJAaG9zdDpkaXIKY2FzZSAiJFRFUk0iIGluCnh0ZXJtKnxyeHZ0KnxFdGVybXxhdGVybXxrdGVybXxnbm9tZSp8YWxhY3JpdHR5KQogICAgVEVSTV9USVRMRT0kJ1xlXTA7JHtkZWJpYW5fY2hyb290OisoJGRlYmlhbl9jaHJvb3QpfSR7VklSVFVBTF9FTlY6KygkKGJhc2VuYW1lICRWSVJUVUFMX0VOVikpfSVuQCVtOiAlflxhJwogICAgOzsKKikKICAgIDs7CmVzYWMKCnByZWNtZCgpIHsKICAgICMgUHJpbnQgdGhlIHByZXZpb3VzbHkgY29uZmlndXJlZCB0aXRsZQogICAgcHJpbnQgLVBuciAtLSAiJFRFUk1fVElUTEUiCgogICAgIyBQcmludCBhIG5ldyBsaW5lIGJlZm9yZSB0aGUgcHJvbXB0LCBidXQgb25seSBpZiBpdCBpcyBub3QgdGhlIGZpcnN0IGxpbmUKICAgIGlmIFsgIiRORVdMSU5FX0JFRk9SRV9QUk9NUFQiID0geWVzIF07IHRoZW4KICAgICAgICBpZiBbIC16ICIkX05FV19MSU5FX0JFRk9SRV9QUk9NUFQiIF07IHRoZW4KICAgICAgICAgICAgX05FV19MSU5FX0JFRk9SRV9QUk9NUFQ9MQogICAgICAgIGVsc2UKICAgICAgICAgICAgcHJpbnQgIiIKICAgICAgICBmaQogICAgZmkKfQoKIyBlbmFibGUgY29sb3Igc3VwcG9ydCBvZiBscywgbGVzcyBhbmQgbWFuLCBhbmQgYWxzbyBhZGQgaGFuZHkgYWxpYXNlcwppZiBbIC14ICRURVJNVVhfUk9PVC91c3IvYmluL2RpcmNvbG9ycyBdOyB0aGVuCiAgICB0ZXN0IC1yIH4vLmRpcmNvbG9ycyAmJiBldmFsICIkKGRpcmNvbG9ycyAtYiB+Ly5kaXJjb2xvcnMpIiB8fCBldmFsICIkKGRpcmNvbG9ycyAtYikiCiAgICBhbGlhcyBscz0nbHMgLS1jb2xvcj1hdXRvJwogICAgI2FsaWFzIGRpcj0nZGlyIC0tY29sb3I9YXV0bycKICAgICNhbGlhcyB2ZGlyPSd2ZGlyIC0tY29sb3I9YXV0bycKCiAgICBhbGlhcyBncmVwPSdncmVwIC0tY29sb3I9YXV0bycKICAgIGFsaWFzIGZncmVwPSdmZ3JlcCAtLWNvbG9yPWF1dG8nCiAgICBhbGlhcyBlZ3JlcD0nZWdyZXAgLS1jb2xvcj1hdXRvJwogICAgYWxpYXMgZGlmZj0nZGlmZiAtLWNvbG9yPWF1dG8nCiAgICAjYWxpYXMgaXA9J2lwIC0tY29sb3I9YXV0bycKCiAgICBleHBvcnQgTEVTU19URVJNQ0FQX21iPSQnXEVbMTszMW0nICAgICAjIGJlZ2luIGJsaW5rCiAgICBleHBvcnQgTEVTU19URVJNQ0FQX21kPSQnXEVbMTszNm0nICAgICAjIGJlZ2luIGJvbGQKICAgIGV4cG9ydCBMRVNTX1RFUk1DQVBfbWU9JCdcRVswbScgICAgICAgICMgcmVzZXQgYm9sZC9ibGluawogICAgZXhwb3J0IExFU1NfVEVSTUNBUF9zbz0kJ1xFWzAxOzMzbScgICAgIyBiZWdpbiByZXZlcnNlIHZpZGVvCiAgICBleHBvcnQgTEVTU19URVJNQ0FQX3NlPSQnXEVbMG0nICAgICAgICAjIHJlc2V0IHJldmVyc2UgdmlkZW8KICAgIGV4cG9ydCBMRVNTX1RFUk1DQVBfdXM9JCdcRVsxOzMybScgICAgICMgYmVnaW4gdW5kZXJsaW5lCiAgICBleHBvcnQgTEVTU19URVJNQ0FQX3VlPSQnXEVbMG0nICAgICAgICAjIHJlc2V0IHVuZGVybGluZQoKICAgICMgVGFrZSBhZHZhbnRhZ2Ugb2YgJExTX0NPTE9SUyBmb3IgY29tcGxldGlvbiBhcyB3ZWxsCiAgICB6c3R5bGUgJzpjb21wbGV0aW9uOionIGxpc3QtY29sb3JzICIkeyhzLjouKUxTX0NPTE9SU30iCiAgICB6c3R5bGUgJzpjb21wbGV0aW9uOio6KjpraWxsOio6cHJvY2Vzc2VzJyBsaXN0LWNvbG9ycyAnPSgjYikgIyhbMC05XSMpKj0wPTAxOzMxJwpmaQoKIyBzb21lIG1vcmUgbHMgYWxpYXNlcwphbGlhcyBsbD0nbHMgLWwnCmFsaWFzIGxhPSdscyAtQScKYWxpYXMgbD0nbHMgLUNGJwoKIyBlbmFibGUgYXV0by1zdWdnZXN0aW9ucyBiYXNlZCBvbiB0aGUgaGlzdG9yeQppZiBbIC1mICRURVJNVVhfUk9PVC91c3Ivc2hhcmUvenNoLWF1dG9zdWdnZXN0aW9ucy96c2gtYXV0b3N1Z2dlc3Rpb25zLnpzaCBdOyB0aGVuCiAgICAuICRURVJNVVhfUk9PVC91c3Ivc2hhcmUvenNoLWF1dG9zdWdnZXN0aW9ucy96c2gtYXV0b3N1Z2dlc3Rpb25zLnpzaAogICAgIyBjaGFuZ2Ugc3VnZ2VzdGlvbiBjb2xvcgogICAgWlNIX0FVVE9TVUdHRVNUX0hJR0hMSUdIVF9TVFlMRT0nZmc9Izk5OScKZmkKCiMgZW5hYmxlIGNvbW1hbmQtbm90LWZvdW5kIGlmIGluc3RhbGxlZAppZiBbIC1mICRURVJNVVhfUk9PVC9ldGMvenNoX2NvbW1hbmRfbm90X2ZvdW5kIF07IHRoZW4KICAgIC4gJFRFUk1VWF9ST09UL2V0Yy96c2hfY29tbWFuZF9ub3RfZm91bmQKZmkK"


backup_if_exists() {
    # $1 - Name of file, $2 - Path to file
    if [ -f $2 ] || [ -d $2 ]; then
        echo "  $1 already exists, backupping it and replacing with new one"
        mv $2 $2.bak &>$OUTPUT_PIPE
    fi
}


if [ $EUID -eq 0 ]; then
    echo "Run this script as user, not root!"
    exit 2
fi


# Start installation process
echo "Installation process started!"
echo "============================="


# Install zsh and git via apt
echo "- Install zsh and git ..."

apt install zsh git --yes &>$OUTPUT_PIPE


# Setup .zshrc file for user
echo "- Setup .zshrc file for user ..."

backup_if_exists "File" $HOME/.zshrc
base64 -d <<< $ZSHRC_BASE64_ENCODED > $HOME/.zshrc


# Setup .zshrc file for root
if which su &>$OUTPUT_PIPE; then
    echo "- Setup .zshrc file for root ..."

    mkdir -p $HOME/.suroot &>$OUTPUT_PIPE
    backup_if_exists "File" $HOME/.suroot/.zshrc
    base64 -d <<< $ZSHRC_BASE64_ENCODED > $HOME/.suroot/.zshrc
fi


# Setup modules for zsh
echo "- Install additional plugins for zsh ..."

backup_if_exists "Plugin" $TERMUX_ROOT/usr/share/zsh-syntax-highlighting
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $TERMUX_ROOT/usr/share/zsh-syntax-highlighting &>$OUTPUT_PIPE

backup_if_exists "Plugin" $TERMUX_ROOT/usr/share/zsh-autosuggestions
git clone https://github.com/zsh-users/zsh-autosuggestions.git $TERMUX_ROOT/usr/share/zsh-autosuggestions &>$OUTPUT_PIPE


# Change login shell to zsh
echo "- Change login shell to zsh ..."

chsh -s zsh &>$OUTPUT_PIPE


# Setup Fira Code Regular font
echo "- Setup custom font ..."

backup_if_exists "Custom font" $HOME/.termux/font.ttf
curl -L https://github.com/tonsky/FiraCode/releases/download/5.2/Fira_Code_v5.2.zip -o $TMPDIR/firacode.zip &>$OUTPUT_PIPE
unzip $TMPDIR/firacode.zip -d $TMPDIR &>$OUTPUT_PIPE
mkdir -p $HOME/.termux &>$OUTPUT_PIPE
mv $TMPDIR/ttf/FiraCode-Regular.ttf $HOME/.termux/font.ttf &>$OUTPUT_PIPE



# End installation process
echo "================================================"
echo "      Installation process completed!"
echo "Please, re-open Termux to see your new terminal!"
